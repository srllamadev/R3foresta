<!DOCTYPE html>
<html>
<head>
  <title>Mensaje DApp</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
</head>
<body>
  <h1>Mensaje desde el contrato</h1>
  <p id="mensajeActual">Cargando...</p>

  <input type="text" id="nuevoMensaje" placeholder="Escribe un nuevo mensaje">
  <button onclick="actualizarMensaje()">Actualizar Mensaje</button>

  <script>
    // Reemplaza con la dirección de tu contrato desplegado
    const direccionContrato = "0x5c432a795d2aDC085b953604362c897083Fc9b89";

    // Reemplaza con tu ABI copiado desde Remix
       
    //asdasd
    const abi = [
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_nuevoMensaje",
				"type": "string"
			}
		],
		"name": "actualizarMensaje",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_mensajeInicial",
				"type": "string"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [],
		"name": "mensaje",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
    //asdasd

    let web3;
    let contrato;

    window.addEventListener('load', async () => {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await ethereum.request({ method: 'eth_requestAccounts' });

        contrato = new web3.eth.Contract(abi, direccionContrato);
        mostrarMensaje();
      } else {
        alert("¡Instala MetaMask!");
      }
    });

    async function mostrarMensaje() {
      const mensaje = await contrato.methods.mensaje().call();
      document.getElementById("mensajeActual").innerText = mensaje;
    }

    async function actualizarMensaje() {
      const cuentas = await web3.eth.getAccounts();
      const nuevoMensaje = document.getElementById("nuevoMensaje").value;

      await contrato.methods.actualizarMensaje(nuevoMensaje).send({
        from: cuentas[0]
      });

      mostrarMensaje();
    }
  </script>
</body>
</html>
